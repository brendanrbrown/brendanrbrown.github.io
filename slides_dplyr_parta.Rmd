---
title: "data manipulation, part a: basics of data frames"
author: ""
date: ""
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts]
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# What you will learn

- Install and load packages
- Create data frames and 'tibbles'
- Subset rows and columns with base `R`
- Load csv files


**Main reference:** R4DS chapters 5, 9, 10, 11

---
# Packages

Packages are collections of `R` code created by users like you and me.

The `tidyverse` package is really a collection of packages and has essentially all of the data manipulation and presentation tools we will use in this class, including the `dplyr` package.

To **install** any package, type `install.packages('package_name')` into the `R` console.

```{r, eval=FALSE}
install.packages('tidyverse')
```

To **load** a package, making its functions available for use, do

```{r}
library('tidyverse')
```

---
# Data frames and tibbles

**Data frame:** 
- data object organized into rows and columns 
- ubiquitous idea: Excel, Python

**Tibble:** 
- `tidyverse` version of a data frame
- behind-the-scenes improvements

**I will use 'data frame' to refer to 'tibbles'** unless to call out specific differences.
---
# Making tibbles on your computer
.center[![](https://fsmedia.imgix.net/20/c2/28/4c/8620/495f/8419/9ad435c7f36a/deep-space-nine-tribbles-4jpg.jpeg?rect=0%2C57%2C694%2C347&auto=format%2Ccompress&w=650)]

```{r}
tibble(words = c("W", "T", "F?"),
           numbers = c(2, 2^2, 2^3))
```

---
Same result using the base `R` function, *except* the default is to convert strings (characters) to factor type.

```{r, eval = FALSE}
data.frame(words = c("W", "T", "F?"),
           numbers = c(2, 2^2, 2^3))
```

Failing to supply column names gives default names, which make later programming annoying.

```{r}
tibble(c("W", "T", "F?"),
           c(2, 2^2, 2^3))
```

---
# Some tricks

You can use functions to generate vectors in a data frame. 
```{r}
data.frame(rad = pi * seq(1, 6))
```

With `tibble`, you can create new variables from previous ones. This would generate an error
```{r, eval = FALSE}
data.frame(rad = pi * seq(1, 6), y = cos(rad))
```

This works
```{r, eval = FALSE}
tibble(rad = pi * seq(1, 6), y = cos(rad))
```

---

Create a data frame from previously stored vectors. Default names are the object names.

```{r}
x <- seq(1, 10)
big_x <- x >= 5

tibble(x, big_x)
```

---
# Subsetting

```{r}
df <- tibble(rad = pi * seq(1, 5), y = cos(rad))
```

Extract a column vector: `data_frame_name$column_name`. Do this to evaluate the `sin` of `rad` in our data frame. 

```{r}
sin(df$rad)
```

This syntax also works

```{r}
sin(df[, "rad"])
```

---
We can use this syntax to specify a particular row number for the `rad` column.

```{r}
sin(df[2, "rad"])
```

This is also how we **extract rows** from the data frame.

```{r}
df[2, ]
```

We can extract a **subset of rows** by giving a vector of row locations.

```{r, eval=FALSE}
df[c(2, 4, 5), ]
```

---
# Adding and replacing columns

Now I want to **add the `sin` output to my data frame as a new column**, called `z`.

```{r}
df$z <- sin(df$rad)

df
```

---
Actually, I want to **replace the `z` column** with `rad` (radians) in degrees, by multiplying `rad` with $180 / \pi$.

```{r}
df$z <- df$rad * (180 / pi)

df
```

---
# Subsetting rows using conditional statements

We can use logical statements to subset rows of a data frame. If we specify a logical vector as follows, only the row indices corresponding to `TRUE` values will be returned

```{r}
df[c(TRUE, FALSE, FALSE, TRUE, FALSE), ]
```

---
We can now subset rows based on information in the data itself. E.g. to get only rows whose cosine is -1, generate this logical vector

```{r}
df$y < 0
```

and use it like this

```{r}
df[df$y < 0, ]
```


---
# Now you try!
.center[![](https://ichef.bbci.co.uk/wwfeatures/live/624_351/images/live/p0/26/0z/p0260z5q.jpg)]

---
# Tutorial
**15 minutes to**, using the base `R` functions only,

Create an hmtl R Markdown document with the following:

1. Load the `starwars` dataset from the `tidyverse` package. (Just load the package and a hidden object called `starwars` is available to you.)
2. Create a new data frame with only name, height in cm, mass in kg and species variables.
3. Add a column called `mph` with mass per height for each observation.
4. Convert the height variable from cm to inches.
5. Report the following summary statistics for height in inches:
  - average
  - maximum
  - median (hint: use `quantile`)
  
Learn about the dataset by typing `?starwars`.
  
```{r, echo=FALSE, eval = FALSE}
df <- starwars[, c("name", "height", "mass", "species")]
```
  

